;Telnet接続を利用してAlpine Linuxの起動を判定・待機するマクロ

;環境変数を展開して設定を反映
expandenv host "localhost:%QEMU_SERIAL_PORT% /nossh /T=1"

;接続
connect host

if result <> 2 then 
    ;接続に失敗したので異常終了
    setexitcode -1
    end
endif

;ターミナル非表示
showtt -1

;起動済みだと一度enterを送らないとログインプロンプトが出ないっぽい？ので送信
sendln ""

;ログインプロンプトの表示を待つ
wait "localhost login:"

;切断
disconnect 0

;正常終了
setexitcode 0

end